\chapter{Probabilistic Modeling}

\section{Modeling with Probability Distributions}

% use this section to illustrate modeling with a poisson rv
At a facility that manufactures recreational sports
  vehicles (ATVs), each vehicle is subjected to a final
  inspection. The rate of defects during final inspection is
  $\lambda=1.5$ defects per vehicle.
\begin{enumerate}
\item What is an appropriate probability distribution to model the
number of defects? \label{atv1}
\item What proportion of vehicles have more than 2 defects? \label{atv2}
\item Management has set a new goal that the proportion
of vehicles with no defects is .5. What rate $\lambda$ would
achieve this goal? \label{atv3}
\end{enumerate}

We are interested in the number of defects, which is discrete.
The Poisson distribution makes sense because it is commonly used
for count data. Moreover, we are given information for a single
parameter, and the Poisson distribution has a single parameter.
If we let the random variable $X$ represent the number of defects
per vehicle, then a reasonable distribution is
\[ X \sim \text{Poisson}(\lambda=1.5) \]
For part~\ref{atv2},
\begin{align*}
P(X>2) &= 1 - P(X \leq 2)\\
       &= 1 - \sum_{x=0}^2 \frac{e^{-\lambda}\lambda^x}{x!}\\
       &= 0.191
\end{align*}
For part \ref{atv3}, management's goal is that $P(X=0)=0.5$, or
\[ P(X=0) = \frac{e^{-\lambda}\lambda^0}{0!} = e^{-\lambda}=0.5 \]
Then
\[ \lambda = -\ln{0.5} = 0.693 \]

% discussion on the Normal distribution
A refinery makes two grades of gasoline, regular and premium.  The
advertised octane ratings are 87 for regular gasoline and 89 for
premium gasoline.  The quality engineer at the refinery asks for 10
samples from one of the two types of gasoline. She does not know for
sure whether the samples are from the regular batch or the premium
batch. She devises the hypothesis test
\begin{align*}
H_0: \mu &\leq 87 \\
H_1: \mu &> 87
\end{align*}
and sets the confidence level to be 0.995. Suppose that the mean of
the 10 samples is 88.3 and the standard deviation is 1.0. What is her
conclusion for the hypothesis test?

Suppose that a gas station owner has his own octane test
kit and rule for accepting a tanker-truck of premium gasoline.
The owner knows from past shipments that the distributions
of octane ratings are
\begin{align*}
X_{\text{regular}} &\sim N(87,1) \\
X_{\text{premium}} &\sim N(89,1)
\end{align*}
Although the owner may not think about it explicitly, his hypothesis
test is
\begin{align*}
H_0: \mu &= 87 \\
H_1: \mu &= 89
\end{align*}
The owner takes one sample from the tanker-truck. If the octane
measurement is greater than 88.5, then he will accept the shipment as
premium gasoline. What is the probability that the owner accepts a
shipment of regular gasoline as premium (i.e. what is $\alpha$)? What
is the probability that he declines a shipment of premium gasoline,
claiming that he thinks it is regular (i.e. what is $\beta$)?  Use the
Normal distribution for this problem. The following diagram may help.

\begin{tikzpicture}
\begin{axis}[
  no markers, domain=0:12, samples=100,
  height=5cm, width=15cm,
  axis x line=bottom,
  axis y line=none,
  xtick=\empty, ytick=\empty,
  extra x ticks={4,6,7},
  extra x tick labels={87,88.5,89},
  enlargelimits=false, clip=false
  ]
  
  \addplot [fill, pattern=north west lines, domain=0:6] {gauss(7,1)} \closedcycle;
  \addplot [fill, draw=none, domain=6:12] {gauss(4,1)} \closedcycle;
  \addplot [thick] {gauss(4,1)};
  \addplot [thick] {gauss(7,1)};

  \draw [ultra thin] (4,0) -- (4,.3989);
  \draw [ultra thin] (7,0) -- (7,.3989);

  \draw (4,.42) node[anchor=south] {$H_0$};
  \draw (7,.42) node[anchor=south] {$H_1$};

  \draw (4.9,.15) node[anchor=east] (beta) {$\beta$};
  \draw (5.4,.03) node (beta2) {};
  \draw[-] (beta) -- (beta2);

  \draw (6.5,.15) node[anchor=west] (alpha) {$\alpha$};
  \draw (6.1,.005) node (alpha2) {};
  \draw[-] (alpha) -- (alpha2);
  
\end{axis}
\end{tikzpicture}

For the quality engineer, the test statistic is
\[
t_0 = \left( \overline{X} - \mu_0 \right)\frac{\sqrt{n}}{S} 
= \left(88.3 - 87\right) \frac{\sqrt{10}}{1} 
 = 4.11
\]
and since $t_0 > t_{\alpha,n-1}=3.25$ ($\alpha=0.005$) she will
reject $H_0$ and conclude that the samples are from the premium
batch of gasoline.

For the station owner,
\begin{align*}
\alpha &= P(X > 88.5 \mid H_0) \\
&= P\left( Z > \frac{88.5-87}{1} \right) \\
&= 1 - P(Z < 1.5) \\
&= 0.067
\end{align*}
and
\begin{align*}
\beta &= P(X < 88.5 \mid H_1) \\
&= P\left( Z < \frac{88.5-89}{1} \right) \\
&= P(Z < -0.5) \\
&= 0.309
\end{align*}


\section{Stochastic Processes}

% Use this section to introduce the idea of a Poisson Process.
% add explanatory material.
\emph{A Poisson Process.} A statistician has observed the behavior of
a Hollywood celebrity for about one year and has noted that between
the hours of 8pm and 11pm this celebrity generates, on average, three
tweets per hour and that the rate is approximately the same within
each one-hour period.  We can count the \emph{number} of tweets that
occur in a time interval $t$. We can also measure the \emph{time}
between tweets. Here is a depiction of the tweets from last night.

\vspace{.2in}
\begin{center}
\begin{tikzpicture}

\draw (0,0) -- (11,0)
  node[pos=0.35/11]{x}
  node[pos=0.87/11]{x}
  node[pos=4.74/11]{x}
  node[pos=5.05/11]{x}
  node[pos=5.92/11]{x}
  node[pos=6.65/11]{x}
  node[pos=6.93/11]{x}
  node[pos=8.50/11]{x}
  node[pos=10.07/11]{x}
;
\node[below] at (0,-.2) {8pm};
\draw (0,-.2) -- (0,.2);
\node[below] at (11/3,-.2) {9pm};
\draw (11/3,-.2) -- (11/3,.2);
\node[below] at (22/3,-.2) {10pm};
\draw (22/3,-.2) -- (22/3,.2);
\node[below] at (11,-.2) {11pm};
\draw (11,-.2) -- (11,.2);


\end{tikzpicture}
\end{center}

Let the random variable $Y$ be the number of tweets from
the celebrity in some time interval.
When we say that the number of tweets in a time interval $t$ follows
a Poisson distribution with mean $\lambda t$, we write
\[
  Y \sim \text{Poisson($\lambda t$)}
\]
If $t$ is one hour, then we can write
\[
  Y \sim \text{Poisson($\lambda = 3$)}
\]
Stating that the number of tweets follows a Poisson distribution
implies that the time between tweets follows an Exponential
distribution (and vice versa). Let the random variable $X$ be
the time between tweets. Then
\[
  Y \sim \text{Poisson($\lambda t$)} \Longleftrightarrow X \sim \text{Exp($\lambda$)}
\]
Yes, it is the same $\lambda$ in each distribution.
The average number of tweets is $\lambda=3$ per hour. The average
time between tweets is $1/\lambda = 1/3$ hour (or 20 minutes).
Recall that for the Exponential distribution
\[
  E(X) = \frac{1}{\lambda} = \frac{1~\text{hour}}{3~\text{tweets}} = 20 ~\text{minutes per tweet on average}
\]

Questions.
\begin{enumerate}
\item What is the probability that the celebrity sends out five or
  more tweets in one hour?
\item What is the probability that the celebrity sends out
  no tweets between 9pm and 11pm?
\end{enumerate}

\section{Queueing Models}

\section{Exercises}

\begin{enumerate}
  
\subsubsection*{Modeling with Probability Distributions.}

% this problem is OK
% Geometric
\item \emph{Searching for an item.} Albert has \num{1176} Pok\'{e}mon
  cards in total.  Pok\'{e}mon EX is a special type of card, and
  Albert has 39 EX-type cards.  He is looking for an EX-type card, but
  all of the cards are completely mixed up and stored in a shoe
  box. His mother is calling him for dinner.  What is the probability
  that Albert will have to look through no more than 25 cards before
  he finds an EX-type card?

\begin{solution}
\bs Consider finding an EX-type card to be a ``success''. Let $X$ be a
random variable that represents the number of cards that Albert has to
handle up to and including the first success. Then
\[
X \sim \text{Geometric}(p=\frac{39}{1176})
\]
and
\[
P(X \leq 25) = 1 - (1 - p)^{25} \approx 0.57.
\]
\end{solution}

% this problem is OK
% Binomial, odds, probabilities
\item \emph{Playing Pok\`{e}mon.} Albert is playing
  Pok\'{e}mon cards with his friend. It's Albert's turn, and he
  decides to use Marowak. The card says the following.
\begin{quote}
\emph{Flip a coin four times. The amount of damage done to your opponent's
Pok\'{e}mon is the number of heads times 40.}
\end{quote}
What are the odds that Marowak will do at least 120 damage to the
opponent? One approach to answer this question is to use the Binomial
distribution to compute the probability of doing at least 120 damage
and then convert from probability to odds. You can take another
approach if you prefer. In any case, assume that the coin is fair,
i.e.\ the probability of getting heads on any particular toss is 1/2.

\begin{solution}
\bs
In order to do at least 120 damage, we need either three or four heads
out of the four coin tosses. Let $X$ represent the number of heads obtained
in four tosses of a fair coin. Then $X \sim \text{Binomial}(p=1/2,n=4)$.
\begin{align*}
P(X=3) + P(X=4) &= {4 \choose 3} p^3 (1-p)^1 + {4 \choose 4} p^4 (1-p)^0 \\
&= \frac{1}{4} + \frac{1}{16} \\
&= \frac{5}{16}
\end{align*}
The odds are
\[
\frac{p}{1-p} = \frac{\frac{5}{16}}{1-\frac{5}{16}} = \frac{5}{11}
\]
or 5 to 11.
\end{solution}

% this problem is OK
% Exponential distribution
\item \emph{Evaluating a warranty.}
  A manufacturer of automotive batteries offers a one-year
  warranty. If the battery fails for any reason during the warranty
  period, it is replaced for free. The time to failure is distributed
  Exponential with rate $\lambda=.125$ failures per year.
\begin{enumerate}
\item What proportion of batteries fail within the warranty period?
\item The cost to manufacture a battery is \$50, and the profit
per battery is \$25. What is the effect of the warranty replacement
policy on profit? \label{ex:profit}
\end{enumerate}

\begin{solution}
  \bs The question is asking for the theoretical proportion of
  batteries that fail within one year. Since all batteries have the
  same probability of failure, this proportion is equal to the
  probability that a single battery will fail within one year. Let $X$
  be a random variable that represents the time to failure.
\[ P(X<1) = 1-e^{-\lambda t} = 1 - e^{-.125} = 0.118 \]
Now, imagine that the manufacturer has, over time,
  sold many batteries and has kept data on how many batteries failed
  within one year. The empirical proportion is simply the number
  of batteries that failed divided by the number of batteries sold.
  The Law of Large Numbers tells us that when the number of batteries
  sold is large, the empirical proportion will be approximately
  equal to the theoretical proportion.

Taking the warranty into account, the average profit per battery is
\[ \$25 - 0.118\times \$50 = \$19.10 \]
So, the (average) effect of the warranty on profit is -\$5.90.
\end{solution}

% this problem has been re-written
% Poisson distribution
\item \emph{Donut giveaway.}  A professional baseball team has just
  won a game that secured them a berth in the leagueâ€™s playoffs. To
  celebrate, a local donut shop will be giving away up to 200 free
  donuts during a two-hour period on the morning following the
  victory. All 200 donuts will be baked and decorated with a baseball
  theme before the giveaway starts. If there are any donuts remaining
  after the giveaway, they will be sold at a discounted price. Assume
  that customers will arrive at the giveaway according to a Poisson
  process at a mean rate of 100 customers per hour. Also, note that
  there is a limit of one donut per customer.
\begin{enumerate}
	\item What is the probability that there will be donuts remaining after the giveaway? \label{ex:donuta}
	\item What is the predicted number of donuts that will be remaining after the giveaway? \label{ex:donutb}
\end{enumerate}

For part~\ref{ex:donuta}, present your answer as an expression for the
probability that there will be donuts remaining. Then, use software,
such as R, to compute a numerical answer.

\begin{solution}
  \bs Given that customers arrive to the giveaway according to a
  Poisson process with a mean of 100 customers per hour, the number of
  customers that arrive during the two-hour period is Poisson
  distributed with a mean of 200. Let $N$ be the number of customers
  arriving in a two-hour period. Then
\[ N ~ \text{Poisson}(\lambda = 200) \]
For part~\ref{ex:donuta}, the probability that there will be donuts remaining after the giveaway is 
\begin{align*}
      P(N < 200) &= \sum_{n=0}^{199} \frac{\lambda^n e^{-\lambda}}{n!}\\
      &= \sum_{n=0}^{199} \frac{200^n e^{-200}}{n!}\\
      &\approx .49
\end{align*}
In R,
\begin{Verbatim}
> sum(dpois(0:199,200))
[1] 0.4905966
\end{Verbatim}  

For part~\ref{ex:donutb}, our calculations are all done in expectation
(or on average). There are 200 customers in 2 hours, which means that
200 donuts are given away. So, on average, no donuts are remaining.
\end{solution}

% needs to be re-written
% Poisson distrubtion
\item \emph{College expenses.}  A college student has a part-time job
  assisting with research on campus. The student receives monthly
  paychecks of \$150 that are deposited into an account to cover her
  expenses at college. \$30 is withdrawn from the account randomly
  throughout the month, and the time between withdrawals is
  exponential with a mean of five days. Determine the probability that
  the student will run out of money in the account after 30 days.

\begin{solution}
\bs
Let $X$ be a random variable that represents the time between
withdrawals. The mean time between withdrawals, that is to say the
expected value of $X$ ($E(X)$), is five days. We know that for
the Exponential distribution
\[ E(X) = \frac{1}{\lambda} \]
where $\lambda$ is the rate (in units of withdrawals
per day). So,
\[ X \sim \text{Exp}(\lambda = 1/5~\text{withdrawals per day}) \]
If the time between withdrawals is distributed Exponential with
rate $\lambda$, then the number of withdrawals in $t$ days
is Poisson with mean $\lambda t$. Let $N$ be the number of withdrawals in 30 days.
\[ N \sim \text{Poisson}(\lambda = \lambda \times 30 = 6) \]
Now, the probability that the student runs out of money is
\begin{align*}
      P(N \geq 6) &= 1 - P(N \leq 5) \\
      &= 1 - \sum_{n=0}^{5} \frac{\lambda^n e^{-\lambda}}{n!}\\
      &= .55
\end{align*}
You may have defined the event that the student runs out of money as
$P(N = 5)$. In other words, that there are exactly five withdrawals.
This is incorrect because we are modeling the withdrawal activity as a
Poisson process. In other words, the (unstated) assumption is that the
number of withdrawals is independent of the available funds. (Probably
closer to reality?)
\end{solution}

% this problem needs to be re-written, but it can be very similar.
% Poisson distribution
\item \emph{Stocking an item in inventory.}
Demand for an item occurs according to a Poisson distribution with
mean 3 per day. The maximum stock level is 25 items, which occurs on
each Monday immediately after a new order is received. The order size
depends on the number of units left at the end of the week on Saturday
(business is closed on Sundays). Determine the following:
\begin{enumerate}
\item The average weekly size of the order. \label{ex:asize}
\item The probability of shortage at the start of business on Friday. \label{ex:pshort}
\item The probability that the weekly order size exceeds 10 units. \label{ex:pex}
\end{enumerate}

\begin{solution}
\bs
For part~\ref{ex:asize}, the distribution of demand over six days is
Poisson with mean 18 items. So, the average weekly size
of the order is 18 items.

For part~\ref{ex:pshort}, shortage at the start of business on Friday means
that all 25 items sold during Monday through Thursday. Let
$D4$ be a random variable that represents demand over the
first four days of the week.
\[ D4 \sim \text{Poisson}(\lambda = 12) \]
The probability of shortage at the start of the day on Friday is
\begin{align*}
  P(D4 \geq 25) &= 1 - P(D4 \leq 24)\\
                &= 1 - \sum_{n=0}^{24} \frac{12^n e^{-12}}{n!}\\
                &\approx 0.0007
\end{align*}
In R,
\begin{Verbatim}
> 1 - sum(dpois(0:24,12))
[1] 0.0006856332
\end{Verbatim}

For part~\ref{ex:pex}, the order size will exceed 10 units whenever more than
10 items are sold during the six days of the week. Let $D6$ be
the demand over one week, then
\[ D6 \sim \text{Poisson}(\lambda = 18) \]
and the probability that the order size exceeds 10 units is
\begin{align*}
  P(D6 > 10) &= 1 - P(D6 \leq 10) \\
             &= 1 - \sum_{n=0}^{10} \frac{18^n e^{-18}}{n!}\\
             &\approx .97
\end{align*}
Using R,
\begin{Verbatim}
> 1 - sum(dpois(0:10,18))
[1] 0.9696337
\end{Verbatim}
\end{solution}

% this problem needs to be re-written.
% Poisson distribution
\item \emph{Making cookies.} A baker blends 800 chocolate chips into a
  dough mix and, from this, makes 500 cookies.
\begin{enumerate}
\item Find the probability that a randomly picked cookie will have 
exactly three chocolate chips. \label{a}
\item Find the probability that a randomly picked cookie will have
  at least two chocolate chips. \label{b}
\end{enumerate}
Assume that the chocolate chips are mixed thoroughly,
and in a random fashion. Let $X$ be a random variable that represents
the number of chips in a cookie, and assume that $X$ follows a 
Poisson distribution.

\begin{solution}
\bs For part~\ref{a}, we want to know $P(X=3)$.  With 800 chips
randomly mixed into 500 cookies, there will be, on average, $800/500 =
1.6$ chips per cookie.  Then $X \sim \text{Poisson}(\lambda = 1.6)$.
\[
P(X=3) = \frac{e^{-\lambda}\lambda^3}{3!} = \frac{e^{-1.6}1.6^3}{6} = 0.138
\]
For part~\ref{b}, the probability that a cookie has at least two
chips is
\begin{align*}
P(X \geq 2) = 1 - P(X \leq 1) &= 1 - P(X=0) - P(X=1) \\
&= 1 - \frac{e^{-1.6}\times 1.6^0}{0!} - \frac{e^{-1.6}\times 1.6^1}{1!} \\
&= 0.475
\end{align*}
\end{solution}

% this problem is OK
% a poisson process, memory-less property of exponential distribution
\item A dump truck at a mine takes ore to the railroad after 10
  one-ton scoops have been loaded into the truck.  The one-ton scoops
  are loaded from a large diesel-powered shovel independently and at a
  mean rate of seven scoops per hour.  The time between scoops from the
  shovel can be considered to follow an Exponential distribution.

\begin{enumerate}
\item Find the probability that the time between consecutive trips to
  the railroad will be at least one hour.
\item It takes the dump truck 18 minutes to travel to the railroad,
  unload, and return. Suppose the truck returns and finds that no
  scoop is ready to be loaded. What is the probability that the next
  scoop is ready within 5 minutes? \label{item:2}
\end{enumerate}

\begin{solution}
  \bs The time between scoop arrivals is distributed Exponential, so
  we know that the number of arrivals in a time interval is
  distributed Poisson. In particular, the number of arrivals in a
  one-hour period follows a Poisson distribution with mean
  $\lambda=7$. In order for the time between consecutive trips to the
  railroad to take at least one hour, we require that the number of
  arrivals in one hour is nine or less. Let $X$ be the number of
  (scoop) arrivals in a one hour period.
\[
P(X \leq 9) = \sum_{x=0}^9 \frac{e^{-\lambda}\lambda^x}{x!} = .83.
\]
For part \ref{item:2}, we can invoke the memoryless property of the
Exponential distribution. The remaining time until the next arrival is
disitributed Exponential with rate 7 scoops per hour, regardless of how
much time has elapsed since the last arrival. Let $Y$ be the time
until the next arrival, and don't forget to convert from minutes to
hours.
\[
P(Y \leq 5) = 1 - e^{-7\times \frac{5}{60}} = .44
\]
\end{solution}

% this problem needs to be re-written
% normal distribution
\item Normal distribution. A final exam is constructed so that the
  test scores $x$ are approximately normally distributed, with
  parameters $\mu$ and $\sigma$. The instructor (who is nicer than me)
  assigns letter grades to the test scores as shown in the table
  below. This is known as ``grading on the curve''. What fraction of
  the class gets A, B, C, D, F?

\begin{tabular}{lc}
test score & letter grade \\ \hline
$\mu+\sigma < x$ & A \\
$\mu < x < \mu+\sigma$ & B \\
$\mu-\sigma < x < \mu$ & C \\
$\mu-2\sigma < x < \mu-\sigma$ & D \\
$x < \mu-2\sigma$ & F
\end{tabular}

\vspace{.1in}
\begin{solution}
\bs
\begin{align*}
\text{A}&\quad 1-P(X<\mu+\sigma)=1-\Phi(1) = .159 \\
\text{B}&\quad P(X<\mu+\sigma)-P(X<\mu)=\Phi(1)-\Phi(0) = .341 \\
\text{C}&\quad P(X<\mu)-P(X<\mu-\sigma)=\Phi(0)-\Phi(-1)=.341 \\
\text{D}&\quad P(X<\mu-\sigma)-P(X<\mu-2\sigma)=\Phi(-1)-\Phi(-2)=.136 \\
\text{F}&\quad P(X<\mu-2\sigma)=\Phi(-2) = .023
\end{align*}
\end{solution}

% this problem needs to be re-written
% Lognormal distribution
\item \emph{Stock prices.} The prices of stocks are often modeled
  with a lognormal distribution. An investor is considering purchasing
  stock in one of two companies, A or B. The price of a share of stock
  today is \$1 for both companies. For company A, the value of the
  stock one year from now is modeled as lognormal with parameters
  $\mu=.05$ and $\sigma=.1$. For company B, the value of the stock one
  year from now is modeled as lognormal with parameters $\mu=.02$ and
  $\sigma=.2$.
\begin{enumerate}
\item Find the mean of the price of one share of company A one year
  from now. \label{a1}
\item Find the probability that the price of one share of company A
  one year from now will be greater than \$1.20. \label{a2}
\item Find the mean of the price of one share of company B one year
  from now. \label{b1}
\item Find the probability that the price of one share of company B
  one year from now will be greater than \$1.20. \label{b2}
\end{enumerate}

\begin{solution}
\bs Let $X_A$ and $X_B$ be the price of one share of company A and
company B one year from now, respectively. We know from the problem
description that $X_A \sim \text{LogN}(\mu=.05,\sigma=.1)$ and $X_B
\sim \text{LogN}(\mu=.02,\sigma=.2)$.

For part~\ref{a1}, the mean of $X_A$ is
\[
e^{\mu + \sigma^2/2} = \$1.06
\]
For part~\ref{a2}, 
\begin{align*}
P(X_A > \$1.20) &= P(\ln(X_A) > \ln(1.20)) \\
&= P\left(Z > \frac{\ln(1.20)-.05}{.1}\right) \\
&= P(Z > 1.323) \\
&= 1-P(Z < 1.323) \\
&= .093
\end{align*}
For part~\ref{b1}, the mean of $X_B$ is
\[
e^{\mu + \sigma^2/2} = \$1.04
\]
For part~\ref{b2}, 
\begin{align*}
P(X_B > \$1.20) &= P(\ln(X_B) > \ln(1.20)) \\
&= P\left(Z > \frac{\ln(1.20)-.02}{.2}\right) \\
&= P(Z > .812) \\
&= 1-P(Z < .812) \\
&= .208
\end{align*}
\end{solution}

\subsubsection*{Stochastic Processes}

\subsubsection*{Queueing Models}

% this problem is ok.
\item \emph{Performance metrics for a queueing system.} Consider a
  single server queueing system with FIFO queue discipline.  For the
  particular day that this system was in operation, the arrival times
  and the service times of the first six customers were
  (0,3,7,9,10,12) and (4,6,2,1,3,1), respectively. Arrival times and
  service times are in minutes.  Compute the average waiting time and
  the average number of customers in the queue for the first six
  customers. It will help to construct a diagram of number in
  system versus time.

\begin{solution}
\bs
    
\pgfplotsset{compat=1.12}
\begin{center}
  \begin{tikzpicture}[scale=1.0]
    \begin{axis}[clip=false,
      width=12cm, height=6cm,
    axis x line=middle,
    axis y line=middle,
    ymin=0, ymax=4.5,
    ytick={0,1,2,3,4},
    yticklabels={0,1,2,3,4},
    xmin=0, xmax=18,
    xtick={2,4,6,8,10,12,14,16},
    xticklabels={2,4,6,8,10,12,14,16},
    x label style={at={(axis description cs:0.5,-0.1)},anchor=north},
    y label style={at={(axis description cs:-0.1,.5)},rotate=90,anchor=south},
    xlabel=Time,
    ylabel=Number in System,
    ]
    \addplot[mark=none, style=thick] coordinates { (0, 1) (3, 1) };
    \addplot[mark=none, style=thick] coordinates { (3, 1) (3, 2) };
    \addplot[mark=none, style=thick] coordinates { (3, 2) (4, 2) };
    \addplot[mark=none, style=thick] coordinates { (4, 1) (4, 2) };
    \addplot[mark=none, style=thick] coordinates { (4, 1) (7, 1) };
    \addplot[mark=none, style=thick] coordinates { (7, 1) (7, 2) };
    \addplot[mark=none, style=thick] coordinates { (7, 2) (9, 2) };
    \addplot[mark=none, style=thick] coordinates { (9, 2) (9, 3) };
    \addplot[mark=none, style=thick] coordinates { (9, 3) (13,3) };
    \addplot[mark=none, style=thick] coordinates { (13, 3) (13,2) };
    \addplot[mark=none, style=thick] coordinates { (13,2) (16,2) };
    \addplot[mark=none, style=thick] coordinates { (16,2) (16,1) };
    \addplot[mark=none, style=thick] coordinates { (16,1) (17,1) };
    \addplot[mark=none, style=thick] coordinates { (17,1) (17,0) };

    \addplot[mark=none,dashed] coordinates { (3,1) (4,1) };
    \addplot[mark=none,dashed] coordinates { (7,1) (16,1) };
    \addplot[mark=none,dashed] coordinates { (9,2) (13,2) };
    \addplot[mark=none,dashed] coordinates { (10,3) (10,0) };
    \addplot[mark=none,dashed] coordinates { (12,3) (12,0) };
    \addplot[mark=none,dashed] coordinates { (16,1) (16,0) };
    \addplot[mark=none,dashed] coordinates { (4,0) (4,1) };
    \addplot[mark=none,dashed] coordinates { (13,0) (13,2) };

    \node at (2,.5) {1};
    \node at (3.5,1.5) {2};
    \node at (8.5,1.5) {3};
    \node at (9.5,2.5) {4};
    \node at (7,.5) {2};
    \node at (11,.5) {3};
    \node at (11,1.5) {4};
    \node at (11,2.5) {5};
    \node at (12.5,.5) {4};
    \node at (12.5,1.5) {5};
    \node at (12.5,2.5) {6};
    \node at (16.5,.5) {6};
    \node at (14.5,.5) {5};
    \node at (14.5,1.5) {6};

  \end{axis}
\end{tikzpicture}
\end{center}

First note that the problem description does \emph{not} tell us that
the times between arrivals and/or the service times are exponentially
distributed. So it is not an $M/M/1$ system.
The total delay of all six customers is $0+1+3+3+3+4=14$. The average
waiting time in the queue is the total delay divided by the number
of customers.
\[ W_q = \frac{14}{6} = 2.3333~\text{min} \]
To compute the average number in the queue, weight the time in queue
by the number of customers. In other words, compute the area under the
curve but above one, and then divide by the total time.
\[ L_q = \frac{14}{17} \]

\end{solution}

% this problem needs to be re-written.
\item \emph{Justification for a capital expense.}
  Cars arrive at the Lincoln Tunnel toll gate according to a Poisson
  process with an average rate of 90 cars per hour. The time for passing
  the gate is exponential with mean 38 seconds.  Drivers complain of
  the long waiting time, and authorities are willing to reduce the
  average passing time to 30 seconds by installing automatic toll
  collecting devices, provided two conditions are satisfied: 1) the
  average number of waiting cars in the present system exceeds 5 and
  2) the percentage of the gate idle time with the new device
  installed does not exceed 10\%. Can the new device be justified?

\begin{solution}
\bs
Cars arrive at the rate
\[ \lambda = 90~\text{cars per hour} \times 1/3600 =
  1~\text{car}/40~\text{seconds} \]
We know that $\mu=1/38$
for the current system and $\mu_{\text{new}}=1/30$ for the new
system.
Condition 1 states that the average number of waiting
cars in the current system must exceed 5.
\[ L_s = \frac{\lambda}{\mu-\lambda} = \frac{1/40}{1/38-1/40} = 19 \]
You may have also computed
\[ L_q = \frac{\lambda^2}{\mu(\mu-\lambda)} =
  \frac{(1/40)^2}{(1/38)(1/38 - 1/40)} = 18.05 \]
Either way, the first condition is satisfied. The second condition
states that the percentage of idle time in the new system cannot
exceed 10\%.
\[ p_0 = 1 - \frac{\lambda}{\mu_{\text{new}}} = 1 - \frac{1/40}{1/30} = .25 \]
The second condition is not satisfied. There is no justification
for the new toll gate device.
\end{solution}

% this problem needs to be re-written
\item \emph{Comparing system configurations.}
  Pete's Market is a small local grocery store with one checkout counter.
  Shoppers arrive at the checkout lane according to a Poisson process,
  with an arrival rate of 15 customers per hour. The checkout service times
  are distributed Exponential with a service rate of 20 customers per hour.
  The manager is considering two options for improving service.
  \begin{compactenum}
    \item Hire a second person to bag groceries while the cashier is scanning
      and collecting money from the customer. With this improved single-server
      operation, the service rate would be increased to 30 customers per hour.
    \item Hire a second person to operate a second checkout counter. The
      two-server operation would have a service rate of 20 customers per
      hour for each server.
  \end{compactenum}
  Determine the improvements that would result, consider the
  relative cost of each option, and make a recommendation to the manager.

\begin{solution}
\bs Let's look at the average number in the queue $L_Q$ and the
average time in queue $W_Q$ as metrics to judge improvement in
system performance. Because the interarrival times and the service
times are exponentially distributed, we can use the results from
section 11.2. Before any improvements are made,
\[ L_q = \frac{\lambda^2}{\mu(\mu-\lambda)} = \frac{15^2}{20(20-15)} = 2.25~\text{cust} \]
and
\[W_q = \frac{L_q}{\lambda} = \frac{2.25}{15} = .15~\text{hour} = 9~\text{min} \]
If they add a second person to the existing single checkout
\[ L_q = \frac{\lambda^2}{\mu(\mu-\lambda)} = \frac{15^2}{30(30-15)} = 0.5~\text{cust} \]
and
\[W_q = \frac{L_q}{\lambda} = \frac{0.5}{15} = 0.0333~\text{hour} = 2~\text{min} \]
and if they add a completely separate second checkout then we
need to use the formulas from section 11.3 for a two-server operation. First,
\[ P_0 = \frac{1}{\sum_{n=0}^{k-1}\frac{\left(\lambda/\mu\right)^n}{n!} + \frac{\left(\lambda/\mu\right)^k}{k!}\left(\frac{k\mu}{k\mu-\lambda}\right)} \]
where $k=2$ servers. Then
\[ L_q = \frac{\left(\lambda/\mu\right)^k\lambda\mu}{(k-1)!(k\mu-\lambda)^2}P_0 \]
and
\[W_q = \frac{L_q}{\lambda}  \]
Plugging values, I got $P_0=0.4545$, $L_q=0.123$, and $W_q=0.0082$ hours or 0.5 minutes.
Considering the relative improvement and the cost
of adding a second checkout, I would recommend option a). That is, to
add a second person to the existing checkout. The average number in
queue and the average time in queue appear to be acceptable for a
grocery store.
\end{solution}


\end{enumerate}
